<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kelola Panduan Guru</title>
<style>
body{margin:0;font-family:"Comic Sans MS",Arial,sans-serif;background:#f4f6fb;padding:30px;min-height:100vh}
h1{text-align:center;margin-bottom:20px}
.btn-back{position:fixed;top:20px;right:20px;padding:8px 14px;background:rgba(0,0,0,0.55);color:#fff;text-decoration:none;border-radius:8px;font-weight:bold;font-size:13px;z-index:9999;transition:transform 0.2s ease,background 0.2s ease}
.btn-back:hover{transform:scale(1.08);background:rgba(0,0,0,0.7)}
.box{max-width:850px;margin:auto;background:#fff;padding:25px;border-radius:20px;box-shadow:0 4px 10px rgba(0,0,0,0.1)}
label{font-weight:bold;display:block;margin-top:15px;margin-bottom:6px}
textarea,input{width:100%;padding:12px;border-radius:12px;border:1px solid #ccc;font-family:inherit}
textarea{min-height:120px;resize:vertical}
input[type="file"]{padding:8px}
.btn{margin-top:15px;padding:10px 18px;border:none;border-radius:20px;font-weight:bold;cursor:pointer}
.btn-save{background:#4caf50;color:#fff}
.btn-soft-delete{background:#f39c12;color:#fff;margin-left:5px}
.btn-restore{background:#27ae60;color:#fff;margin-left:5px}
.btn-delete{background:#f44336;color:#fff;margin-left:5px}
.status{margin-top:15px;padding:12px;background:#e9eefc;border-radius:12px;font-size:14px}
</style>
</head>
<body>

<a href="dashboard-admin.html" class="btn-back">Kembali</a>

<h1>Kelola Panduan Guru</h1>

<div class="box">
  <label>Teks Panduan Tambahan</label>
  <textarea id="teksPanduan" placeholder="Teks ini akan ditambahkan ke panduan guru..."></textarea>

  <div class="status" id="statusPDF"></div>

  <label>Upload PDF Panduan Baru</label>
  <input type="file" id="filePDF" accept="application/pdf">

  <div style="margin-top:15px">
    <button class="btn btn-save" onclick="simpanPanduan()">Simpan Teks / Upload PDF</button>
    <button class="btn btn-soft-delete" onclick="softDeletePDF()">Hapus Sementara PDF</button>
    <button class="btn btn-restore" onclick="restorePDF()">Restore PDF</button>
    <button class="btn btn-delete" onclick="hapusPermanenPDF()">Hapus Permanen PDF</button>
  </div>
</div>

<script>
const KEY_PDF = "panduan_pdf";
const KEY_TAMBAHAN = "panduan_tambahan";
const KEY_SOFT = "panduan_pdf_softdelete";

const teksInput = document.getElementById("teksPanduan");
const statusPDF = document.getElementById("statusPDF");
const fileInput = document.getElementById("filePDF");

teksInput.value = localStorage.getItem(KEY_TAMBAHAN) || "";
if(!localStorage.getItem(KEY_PDF)) localStorage.setItem(KEY_PDF,"panduan-guru.pdf");
if(!localStorage.getItem(KEY_SOFT)) localStorage.setItem(KEY_SOFT,"false");

function updateStatus(){
  const pdf = localStorage.getItem(KEY_PDF);
  const soft = localStorage.getItem(KEY_SOFT);
  if(soft==="true"){
    statusPDF.innerHTML="PDF saat ini: <b>DIHAPUS SEMENTARA</b>";
  } else if(pdf==="panduan-guru.pdf"){
    statusPDF.innerHTML="PDF saat ini: <b>PDF Default Guru</b> ("+pdf+")";
  } else {
    statusPDF.innerHTML="PDF saat ini: <b>PDF Admin</b> (menggantikan default)";
  }
}
updateStatus();

function simpanPanduan(){
  const teks = teksInput.value.trim();
  const file = fileInput.files[0];

  if(teks){
    localStorage.setItem(KEY_TAMBAHAN,teks);
  } else {
    localStorage.removeItem(KEY_TAMBAHAN);
  }

  if(file){
    if(file.type!=="application/pdf"){alert("File harus PDF"); return;}
    const reader = new FileReader();
    reader.onload=function(e){
      localStorage.setItem(KEY_PDF,e.target.result);
      localStorage.setItem(KEY_SOFT,"false");
      alert("PDF admin berhasil disimpan");
      location.reload();
    }
    reader.readAsDataURL(file);
  } else {
    alert("Teks panduan berhasil disimpan");
    location.reload();
  }
}

function softDeletePDF(){
  if(confirm("Apakah ingin menghapus sementara PDF?")){
    localStorage.setItem(KEY_SOFT,"true");
    alert("PDF sekarang dihapus sementara");
    updateStatus();
    localStorage.setItem(KEY_PDF, localStorage.getItem(KEY_PDF)); // trigger storage event
  }
}

function restorePDF(){
  if(confirm("Restore PDF?")){
    localStorage.setItem(KEY_SOFT,"false");
    alert("PDF sudah direstore");
    updateStatus();
    localStorage.setItem(KEY_PDF, localStorage.getItem(KEY_PDF)); // trigger storage event
  }
}

function hapusPermanenPDF(){
  if(confirm("Hapus PDF permanen dan kembalikan default?")){
    localStorage.setItem(KEY_PDF,"panduan-guru.pdf");
    localStorage.setItem(KEY_SOFT,"false");
    alert("PDF dihapus permanen, kembali ke default");
    updateStatus();
    localStorage.setItem(KEY_PDF, localStorage.getItem(KEY_PDF)); // trigger storage event
  }
}
</script>

</body>
</html>