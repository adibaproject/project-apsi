<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Admin - Kelola Cerita</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#f4f6fb;
}
.container{
  padding:24px;
  position:relative;
}
h1{margin-bottom:16px}

/* tombol kembali */
.back{
  position:absolute;
  top:24px;
  right:24px;
  text-decoration:none;
  background:rgba(0,0,0,0.55);
  color:white;
  padding:10px 16px;
  border-radius:8px;
  font-weight:bold;
  font-size:14px;
  transition: transform 0.2s ease, background 0.2s ease;
  z-index:9999;
}
.back:hover{
  transform: scale(1.08);
  background: rgba(0,0,0,0.7);
}

textarea,button{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  border-radius:8px;
  border:1px solid #ccc;
}

button{
  background:#2f3e9e;
  color:white;
  border:none;
  cursor:pointer;
  font-weight:600;
  margin-right:4px;
}

.btn-del{background:#e74c3c}
.btn-edit{background:#f39c12}
.btn-reset{background:#27ae60}
.btn-permanent{background:#b33939}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:16px;
  background:white;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
}
th,td{
  padding:12px;
  border-bottom:1px solid #eee;
  vertical-align:top;
  text-align:left;
}
th{
  background:#f0f2ff;
}

.deleted{
  color:#999;
  text-decoration:line-through;
}
</style>
</head>

<body>
<div class="container">

<a href="dashboard-admin.html" class="back">Kembali</a>

<h1>Kelola Cerita Mimi</h1>

<textarea id="isi" placeholder="Isi cerita / scene"></textarea>

<button onclick="simpan()">Simpan</button>

<table>
<thead>
<tr>
  <th>Scene</th>
  <th>Isi Cerita</th>
  <th>Aksi</th>
</tr>
</thead>
<tbody id="list"></tbody>
</table>

</div>

<script>
let editIndex=null;

const defaultCerita=[
 {isi:"Di sebuah kebun apel, hiduplah seekor ulat bernama Mimi. Mimi sangat suka memakan daun-daun pohon apel."},
 {isi:"Namun, Mimi sering merasa kesepian dan tidak memiliki teman."},
 {isi:"Suatu hari, Mimi melihat kupu-kupu cantik terbang tinggi."},
 {isi:"Bagaimana caranya agar aku bisa terbang? pikir Mimi."},
 {isi:"Mimi pun mencari jawaban kepada pohon apel."},
 {isi:"Pohon apel berkata: bersabarlah, semua ada waktunya."},
 {isi:"Mimi membuat kepompong dan menunggu dengan sabar."},
 {isi:"Hari demi hari berlalu, Mimi berubah menjadi kupu-kupu."},
 {isi:"Pesan moral: Kesabaran membawa kita pada impian."}
];

if(!localStorage.getItem("ceritaData")){
  localStorage.setItem("ceritaData", JSON.stringify(defaultCerita.map(c=>({...c, aktif:true}))));
}

const getData=()=>JSON.parse(localStorage.getItem("ceritaData"));
const saveData=d=>localStorage.setItem("ceritaData", JSON.stringify(d));

function render(){
  list.innerHTML="";
  getData().forEach((c,i)=>{
    const aktif=c.aktif!==false;
    list.innerHTML+=`
      <tr class="${aktif?'':'deleted'}">
        <td>Scene ${i+1}</td>
        <td>${c.isi}</td>
        <td>
          <button class="btn-edit" onclick="edit(${i})" ${!aktif?'disabled':''}>Edit</button>
          ${aktif
            ? `<button class="btn-del" onclick="hapus(${i})">Hapus</button>`
            : `<button class="btn-reset" onclick="restore(${i})">Restore</button>
               <button class="btn-permanent" onclick="hapusPermanen(${i})">Hapus Permanen</button>`}
        </td>
      </tr>
    `;
  });
}

function simpan(){
  const data=getData();
  const obj={isi:isi.value, aktif:true};

  if(!obj.isi.trim()) return alert("Isi cerita kosong");

  if(editIndex===null){
    data.push(obj);
  }else{
    data[editIndex]=obj;
    editIndex=null;
  }

  saveData(data);
  isi.value="";
  render();
}

function edit(i){
  const m=getData()[i];
  if(m.aktif===false) return alert("Scene ini sudah dihapus, restore dulu");
  isi.value=m.isi;
  editIndex=i;
}

function hapus(i){
  const d=getData();
  d[i].aktif=false;
  saveData(d);
  render();
}

function restore(i){
  const d=getData();
  d[i].aktif=true;
  saveData(d);
  render();
}

function hapusPermanen(i){
  const d=getData();
  d.splice(i,1);
  saveData(d);
  render();
}

render();
</script>
</body>
</html>